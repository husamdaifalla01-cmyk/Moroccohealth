# P1.2 ‚Äî Patient Auth Screens

## Prompt ID: P1.2
## Phase: 1 - Patient Web App
## Estimated Time: 4-5 hours
## Prerequisites: P1.1 complete

---

## CONTEXT

You are building the authentication screens for DAWA.ma's Patient Web App. These screens are the first impression ‚Äî they must build trust immediately while being frictionless.

**Flow**: Consent ‚Üí Phone Input ‚Üí OTP Verification ‚Üí Dashboard

**Critical UX Principles** (Product Excellence):
- First impression (<3 seconds): Value proposition clear, primary CTA visible
- Trust signals: Show regulatory compliance, security indicators
- Minimum friction: Phone-only auth, no passwords

**Visual Principles** (Generative Artist):
- Premium gradients with depth
- Inputs that respond to interaction
- Micro-animations that feel natural

---

## SCREENS OVERVIEW

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CONSENT SCREEN                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  üõ°Ô∏è Protection de vos donn√©es                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  DAWA.ma respecte votre vie priv√©e conform√©ment         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  √† la loi 09-08 (CNDP).                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚òë J'accepte le traitement de mes donn√©es (requis)     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚òê J'accepte de recevoir des promotions                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  [ Continuer ]                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        LOGIN SCREEN                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  üì± Connexion                                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Entrez votre num√©ro de t√©l√©phone                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  üá≤üá¶ +212 |_____________________|                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  [ Recevoir le code ]                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  En continuant, vous acceptez nos CGU                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        OTP SCREEN                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  üîê V√©rification                                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Entrez le code envoy√© au +212 6XX XXX XXX             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  [ _ ] [ _ ] [ _ ] [ _ ] [ _ ] [ _ ]                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Renvoyer le code (30s)                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## IMPLEMENTATION STEPS

### Step 1: Auth Layout

Create `apps/patient/src/app/(auth)/layout.tsx`:

```typescript
// ============================================================
// Auth Layout - Centered card with branding
// ============================================================

import Link from 'next/link';

export default function AuthLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 via-white to-primary-50">
      {/* Background pattern */}
      <div 
        className="absolute inset-0 opacity-30"
        style={{
          backgroundImage: `url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L60 30L30 60L0 30z' fill='%2314b8a6' fill-opacity='0.05'/%3E%3C/svg%3E")`,
        }}
      />
      
      <div className="relative flex min-h-screen flex-col items-center justify-center px-4 py-12">
        {/* Logo */}
        <Link href="/" className="mb-8 flex items-center gap-2">
          <div className="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-primary-500 to-primary-600 shadow-lg shadow-primary-500/30">
            <svg className="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <span className="text-2xl font-bold text-gradient">DAWA.ma</span>
        </Link>

        {/* Card container */}
        <div className="w-full max-w-md">
          <div className="relative overflow-hidden rounded-2xl bg-white shadow-soft-lg">
            {/* Top gradient bar */}
            <div className="h-1 bg-gradient-to-r from-primary-400 via-primary-500 to-primary-600" />
            
            {/* Content */}
            <div className="p-8">
              {children}
            </div>
          </div>
          
          {/* Footer */}
          <p className="mt-6 text-center text-sm text-gray-500">
            ¬© {new Date().getFullYear()} DAWA.ma ‚Äî Tous droits r√©serv√©s
          </p>
        </div>
      </div>
    </div>
  );
}
```

### Step 2: Consent Screen

Create `apps/patient/src/app/(auth)/consent/page.tsx`:

```typescript
'use client';

// ============================================================
// Consent Screen - CNDP Compliance
// ============================================================

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { motion } from 'framer-motion';
import { Shield, CheckCircle, Lock, FileText } from 'lucide-react';

import { Button } from '@dawa/ui';

interface ConsentState {
  data_processing: boolean;
  marketing: boolean;
}

export default function ConsentPage() {
  const router = useRouter();
  const [consents, setConsents] = useState<ConsentState>({
    data_processing: false,
    marketing: false,
  });
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async () => {
    if (!consents.data_processing) return;

    setIsSubmitting(true);
    
    // Store consent in session storage for later
    sessionStorage.setItem('dawa_consent', JSON.stringify(consents));
    
    // Navigate to login
    router.push('/login');
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4 }}
    >
      {/* Header */}
      <div className="mb-6 text-center">
        <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary-100">
          <Shield className="h-8 w-8 text-primary-600" />
        </div>
        <h1 className="text-2xl font-bold text-gray-900">
          Protection de vos donn√©es
        </h1>
        <p className="mt-2 text-gray-600">
          DAWA.ma respecte votre vie priv√©e conform√©ment √† la loi 09-08
        </p>
      </div>

      {/* Trust badges */}
      <div className="mb-6 flex justify-center gap-4">
        <div className="flex items-center gap-1.5 rounded-full bg-green-50 px-3 py-1 text-xs text-green-700">
          <Lock className="h-3 w-3" />
          Donn√©es crypt√©es
        </div>
        <div className="flex items-center gap-1.5 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-700">
          <FileText className="h-3 w-3" />
          Conforme CNDP
        </div>
      </div>

      {/* Consent checkboxes */}
      <div className="space-y-4">
        {/* Required consent */}
        <ConsentCheckbox
          checked={consents.data_processing}
          onChange={(checked) => setConsents(prev => ({ ...prev, data_processing: checked }))}
          required
          title="Traitement des donn√©es personnelles"
          description="J'accepte que DAWA.ma traite mes donn√©es pour la gestion de mes commandes et la livraison de m√©dicaments."
        />

        {/* Optional consent */}
        <ConsentCheckbox
          checked={consents.marketing}
          onChange={(checked) => setConsents(prev => ({ ...prev, marketing: checked }))}
          title="Communications promotionnelles"
          description="J'accepte de recevoir des offres et promotions par SMS ou email (optionnel)."
        />
      </div>

      {/* Legal links */}
      <div className="mt-6 flex justify-center gap-4 text-xs text-gray-500">
        <a href="/legal/privacy" className="hover:text-primary-600 hover:underline">
          Politique de confidentialit√©
        </a>
        <span>‚Ä¢</span>
        <a href="/legal/terms" className="hover:text-primary-600 hover:underline">
          Conditions d'utilisation
        </a>
      </div>

      {/* Submit button */}
      <div className="mt-8">
        <Button
          onClick={handleSubmit}
          disabled={!consents.data_processing || isSubmitting}
          loading={isSubmitting}
          fullWidth
          size="lg"
        >
          Continuer
        </Button>
      </div>
    </motion.div>
  );
}

// ============================================================
// Consent Checkbox Component
// ============================================================

interface ConsentCheckboxProps {
  checked: boolean;
  onChange: (checked: boolean) => void;
  required?: boolean;
  title: string;
  description: string;
}

function ConsentCheckbox({
  checked,
  onChange,
  required,
  title,
  description,
}: ConsentCheckboxProps) {
  return (
    <label
      className={`
        flex cursor-pointer gap-4 rounded-xl border-2 p-4 transition-all
        ${checked 
          ? 'border-primary-500 bg-primary-50' 
          : 'border-gray-200 bg-white hover:border-gray-300'
        }
      `}
    >
      {/* Checkbox */}
      <div className="pt-0.5">
        <div
          className={`
            flex h-6 w-6 items-center justify-center rounded-md border-2 transition-all
            ${checked
              ? 'border-primary-500 bg-primary-500'
              : 'border-gray-300 bg-white'
            }
          `}
        >
          {checked && <CheckCircle className="h-4 w-4 text-white" />}
        </div>
      </div>

      {/* Content */}
      <div className="flex-1">
        <div className="flex items-center gap-2">
          <span className="font-medium text-gray-900">{title}</span>
          {required && (
            <span className="rounded bg-red-100 px-1.5 py-0.5 text-xs font-medium text-red-600">
              Requis
            </span>
          )}
        </div>
        <p className="mt-1 text-sm text-gray-500">{description}</p>
      </div>

      {/* Hidden input for form */}
      <input
        type="checkbox"
        checked={checked}
        onChange={(e) => onChange(e.target.checked)}
        className="sr-only"
      />
    </label>
  );
}
```

### Step 3: Login Screen

Create `apps/patient/src/app/(auth)/login/page.tsx`:

```typescript
'use client';

// ============================================================
// Login Screen - Phone Number Input
// ============================================================

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { motion } from 'framer-motion';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Phone, ArrowRight, Loader2 } from 'lucide-react';
import { toast } from 'sonner';

import { Button, Input } from '@dawa/ui';
import { requestOtpSchema, type RequestOtpInput } from '@dawa/validation';

export default function LoginPage() {
  const router = useRouter();
  const [isSubmitting, setIsSubmitting] = useState(false);

  // Check consent on mount
  useEffect(() => {
    const consent = sessionStorage.getItem('dawa_consent');
    if (!consent) {
      router.push('/consent');
    }
  }, [router]);

  const {
    register,
    handleSubmit,
    formState: { errors },
    watch,
  } = useForm<RequestOtpInput>({
    resolver: zodResolver(requestOtpSchema),
    defaultValues: {
      phone: '+212',
    },
  });

  const phoneValue = watch('phone');

  const onSubmit = async (data: RequestOtpInput) => {
    setIsSubmitting(true);

    try {
      const response = await fetch('/api/auth/request-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (!result.success) {
        toast.error(result.error || 'Erreur lors de l\'envoi du code');
        return;
      }

      // Store phone for verify page
      sessionStorage.setItem('dawa_phone', data.phone);
      
      // Navigate to verify
      router.push('/verify');
    } catch (error) {
      toast.error('Erreur de connexion. Veuillez r√©essayer.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4 }}
    >
      {/* Header */}
      <div className="mb-8 text-center">
        <div className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-primary-100">
          <Phone className="h-8 w-8 text-primary-600" />
        </div>
        <h1 className="text-2xl font-bold text-gray-900">Connexion</h1>
        <p className="mt-2 text-gray-600">
          Entrez votre num√©ro pour recevoir un code de v√©rification
        </p>
      </div>

      {/* Form */}
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
        {/* Phone Input with Morocco flag */}
        <div>
          <label className="mb-2 block text-sm font-medium text-gray-700">
            Num√©ro de t√©l√©phone
          </label>
          <div className="relative">
            {/* Morocco flag */}
            <div className="absolute left-3 top-1/2 flex -translate-y-1/2 items-center gap-2 border-r border-gray-200 pr-3">
              <span className="text-lg">üá≤üá¶</span>
            </div>
            
            <input
              type="tel"
              {...register('phone')}
              placeholder="+212 6XX XXX XXX"
              className={`
                w-full rounded-xl border bg-white py-3 pl-16 pr-4 text-lg
                transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-offset-0
                ${errors.phone
                  ? 'border-error-main focus:border-error-main focus:ring-error-main/20'
                  : 'border-gray-200 hover:border-gray-300 focus:border-primary-500 focus:ring-primary-500/20'
                }
              `}
            />
          </div>
          
          {errors.phone && (
            <p className="mt-2 text-sm text-error-main">{errors.phone.message}</p>
          )}
          
          <p className="mt-2 text-xs text-gray-500">
            Format: +212 suivi de 6 ou 7, puis 8 chiffres
          </p>
        </div>

        {/* Submit button */}
        <Button
          type="submit"
          disabled={isSubmitting || phoneValue.length < 13}
          loading={isSubmitting}
          fullWidth
          size="lg"
          rightIcon={<ArrowRight className="h-5 w-5" />}
        >
          Recevoir le code
        </Button>
      </form>

      {/* Terms */}
      <p className="mt-6 text-center text-xs text-gray-500">
        En continuant, vous acceptez nos{' '}
        <a href="/legal/terms" className="text-primary-600 hover:underline">
          Conditions d'utilisation
        </a>{' '}
        et notre{' '}
        <a href="/legal/privacy" className="text-primary-600 hover:underline">
          Politique de confidentialit√©
        </a>
      </p>
    </motion.div>
  );
}
```

### Step 4: OTP Verification Screen

Create `apps/patient/src/app/(auth)/verify/page.tsx`:

```typescript
'use client';

// ============================================================
// OTP Verification Screen
// ============================================================

import { useState, useEffect, useRef, useCallback } from 'react';
import { useRouter } from 'next/navigation';
import { motion } from 'framer-motion';
import { KeyRound, ArrowLeft, RefreshCw, CheckCircle } from 'lucide-react';
import { toast } from 'sonner';

import { Button } from '@dawa/ui';
import { formatPhone } from '@dawa/utils';

const OTP_LENGTH = 6;
const RESEND_COOLDOWN = 30;

export default function VerifyPage() {
  const router = useRouter();
  const [phone, setPhone] = useState('');
  const [otp, setOtp] = useState<string[]>(Array(OTP_LENGTH).fill(''));
  const [isVerifying, setIsVerifying] = useState(false);
  const [isResending, setIsResending] = useState(false);
  const [resendCooldown, setResendCooldown] = useState(RESEND_COOLDOWN);
  const [verifySuccess, setVerifySuccess] = useState(false);
  
  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);

  // Get phone from session
  useEffect(() => {
    const storedPhone = sessionStorage.getItem('dawa_phone');
    if (!storedPhone) {
      router.push('/login');
      return;
    }
    setPhone(storedPhone);
  }, [router]);

  // Cooldown timer
  useEffect(() => {
    if (resendCooldown > 0) {
      const timer = setTimeout(() => setResendCooldown(c => c - 1), 1000);
      return () => clearTimeout(timer);
    }
  }, [resendCooldown]);

  // Handle input change
  const handleChange = (index: number, value: string) => {
    // Only allow digits
    if (value && !/^\d$/.test(value)) return;

    const newOtp = [...otp];
    newOtp[index] = value;
    setOtp(newOtp);

    // Auto-focus next input
    if (value && index < OTP_LENGTH - 1) {
      inputRefs.current[index + 1]?.focus();
    }

    // Auto-submit when complete
    if (newOtp.every(d => d) && newOtp.join('').length === OTP_LENGTH) {
      handleVerify(newOtp.join(''));
    }
  };

  // Handle backspace
  const handleKeyDown = (index: number, e: React.KeyboardEvent) => {
    if (e.key === 'Backspace' && !otp[index] && index > 0) {
      inputRefs.current[index - 1]?.focus();
    }
  };

  // Handle paste
  const handlePaste = (e: React.ClipboardEvent) => {
    e.preventDefault();
    const pastedData = e.clipboardData.getData('text').slice(0, OTP_LENGTH);
    if (!/^\d+$/.test(pastedData)) return;

    const newOtp = [...otp];
    pastedData.split('').forEach((char, i) => {
      if (i < OTP_LENGTH) newOtp[i] = char;
    });
    setOtp(newOtp);

    // Focus appropriate input
    const nextEmpty = newOtp.findIndex(d => !d);
    if (nextEmpty !== -1) {
      inputRefs.current[nextEmpty]?.focus();
    } else {
      handleVerify(newOtp.join(''));
    }
  };

  // Verify OTP
  const handleVerify = async (code: string) => {
    setIsVerifying(true);

    try {
      const response = await fetch('/api/auth/verify-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone, code }),
      });

      const result = await response.json();

      if (!result.success) {
        toast.error(result.error || 'Code incorrect');
        // Clear OTP on error
        setOtp(Array(OTP_LENGTH).fill(''));
        inputRefs.current[0]?.focus();
        return;
      }

      // Success animation
      setVerifySuccess(true);
      toast.success('Connexion r√©ussie !');

      // Redirect after animation
      setTimeout(() => {
        sessionStorage.removeItem('dawa_phone');
        sessionStorage.removeItem('dawa_consent');
        router.push('/');
      }, 1500);
    } catch (error) {
      toast.error('Erreur de connexion. Veuillez r√©essayer.');
      setOtp(Array(OTP_LENGTH).fill(''));
    } finally {
      setIsVerifying(false);
    }
  };

  // Resend OTP
  const handleResend = async () => {
    if (resendCooldown > 0) return;

    setIsResending(true);

    try {
      const response = await fetch('/api/auth/request-otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone }),
      });

      const result = await response.json();

      if (!result.success) {
        toast.error(result.error || 'Erreur lors du renvoi');
        return;
      }

      toast.success('Nouveau code envoy√© !');
      setResendCooldown(RESEND_COOLDOWN);
      setOtp(Array(OTP_LENGTH).fill(''));
      inputRefs.current[0]?.focus();
    } catch (error) {
      toast.error('Erreur. Veuillez r√©essayer.');
    } finally {
      setIsResending(false);
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4 }}
    >
      {/* Back button */}
      <button
        onClick={() => router.push('/login')}
        className="mb-6 flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700"
      >
        <ArrowLeft className="h-4 w-4" />
        Changer de num√©ro
      </button>

      {/* Header */}
      <div className="mb-8 text-center">
        <motion.div
          className="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full"
          animate={{
            backgroundColor: verifySuccess ? '#dcfce7' : '#f0fdfa',
          }}
        >
          {verifySuccess ? (
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              transition={{ type: 'spring', stiffness: 300 }}
            >
              <CheckCircle className="h-8 w-8 text-green-600" />
            </motion.div>
          ) : (
            <KeyRound className="h-8 w-8 text-primary-600" />
          )}
        </motion.div>
        <h1 className="text-2xl font-bold text-gray-900">V√©rification</h1>
        <p className="mt-2 text-gray-600">
          Entrez le code envoy√© au{' '}
          <span className="font-medium text-gray-900">{formatPhone(phone)}</span>
        </p>
      </div>

      {/* OTP Input */}
      <div className="flex justify-center gap-3">
        {otp.map((digit, index) => (
          <motion.input
            key={index}
            ref={(el) => { inputRefs.current[index] = el; }}
            type="text"
            inputMode="numeric"
            maxLength={1}
            value={digit}
            onChange={(e) => handleChange(index, e.target.value)}
            onKeyDown={(e) => handleKeyDown(index, e)}
            onPaste={handlePaste}
            disabled={isVerifying || verifySuccess}
            className={`
              h-14 w-12 rounded-xl border-2 bg-white text-center text-2xl font-bold
              transition-all duration-200
              focus:outline-none focus:ring-2 focus:ring-offset-0
              disabled:bg-gray-50 disabled:cursor-not-allowed
              ${digit
                ? 'border-primary-500 text-primary-600'
                : 'border-gray-200 text-gray-900'
              }
              ${verifySuccess
                ? 'border-green-500 bg-green-50 text-green-600'
                : 'focus:border-primary-500 focus:ring-primary-500/20'
              }
            `}
            initial={{ scale: 1 }}
            animate={{
              scale: digit ? 1.05 : 1,
            }}
            transition={{ type: 'spring', stiffness: 300 }}
          />
        ))}
      </div>

      {/* Loading indicator */}
      {isVerifying && (
        <div className="mt-6 flex justify-center">
          <div className="flex items-center gap-2 text-sm text-gray-500">
            <div className="h-4 w-4 animate-spin rounded-full border-2 border-primary-500 border-t-transparent" />
            V√©rification en cours...
          </div>
        </div>
      )}

      {/* Resend button */}
      <div className="mt-8 text-center">
        {resendCooldown > 0 ? (
          <p className="text-sm text-gray-500">
            Renvoyer le code dans{' '}
            <span className="font-medium text-gray-700">{resendCooldown}s</span>
          </p>
        ) : (
          <button
            onClick={handleResend}
            disabled={isResending}
            className="inline-flex items-center gap-2 text-sm font-medium text-primary-600 hover:text-primary-700"
          >
            <RefreshCw className={`h-4 w-4 ${isResending ? 'animate-spin' : ''}`} />
            {isResending ? 'Envoi en cours...' : 'Renvoyer le code'}
          </button>
        )}
      </div>
    </motion.div>
  );
}
```

---

## VALIDATION CHECKPOINTS

### Checkpoint 1: Consent Screen
```typescript
// - Required checkbox must be checked to continue
// - Consent stored in sessionStorage
// - Links to legal pages work
```

### Checkpoint 2: Login Screen
```typescript
// - Phone validation works (+212 format)
// - Error messages display in French
// - Loading state during API call
// - Redirects to /verify on success
```

### Checkpoint 3: OTP Screen
```typescript
// - 6-digit input with auto-focus
// - Paste functionality works
// - Auto-submit when complete
// - Resend cooldown timer
// - Success animation
```

---

## SUCCESS CRITERIA

- [ ] Consent required before login
- [ ] Phone validation enforces Moroccan format
- [ ] OTP input has premium feel with animations
- [ ] Error messages clear and actionable
- [ ] Success state with visual feedback
- [ ] Resend cooldown prevents abuse
- [ ] All screens responsive on mobile

---

## NEXT STEP

After validation passes, proceed to:
‚Üí `dawa-docs/prompts/phase-1/P1.3-rx-verification.md`

Reference documentation:
‚Üí `dawa-docs/docs/DAWA_MASTER.md`
‚Üí `dawa-docs/docs/phases/PHASE_1.md`
